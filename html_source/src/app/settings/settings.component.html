<div class="page-container">

    <div class="toolbar mb-2">
        <div class="left">
            <button type="button"
                    class="btn-icon circle big mr-2"
                    (click)="back()">
                <i class="icon dropdown-arrow-left"></i>
            </button>
            <h1>{{ 'SETTINGS.TITLE' | translate }}</h1>
        </div>
        <div class="right"></div>
    </div>

    <div class="page-content">
        <div class="scrolled-content">
            <div class="settings"
                 fxFlex="0 1 50rem"
                 fxLayout="column"
                 fxLayoutAlign="start stretch"
                 fxFlexFill>
                <div class="form__field mb-2">
                    <label>{{ 'SETTINGS.LANGUAGE.TITLE' | translate }}</label>
                    <ng-select class="with-circle"
                               [items]="languagesOptions"
                               bindValue="name"
                               bindLabel="language"
                               [(ngModel)]="variablesService.settings.language"
                               [clearable]="false"
                               [searchable]="false"
                               (change)="onLanguageChange()">
                        <ng-template ng-label-tmp
                                     let-item="item">
                            {{item.language | translate}}
                        </ng-template>
                        <ng-template ng-option-tmp
                                     let-item="item"
                                     let-index="index">
                            {{item.language | translate}}
                        </ng-template>
                    </ng-select>
                </div>

                <div class="form__field mb-2">
                    <label>{{ 'SETTINGS.APP_LOCK.TITLE' | translate }}</label>
                    <ng-select class="with-circle"
                               [items]="appLockOptions"
                               bindValue="id"
                               bindLabel="name"
                               [(ngModel)]="variablesService.settings.appLockTime"
                               [clearable]="false"
                               [searchable]="false"
                               (change)="onLockChange()">
                        <ng-template ng-label-tmp
                                     let-item="item">
                            {{item.name | translate}}
                        </ng-template>
                        <ng-template ng-option-tmp
                                     let-item="item"
                                     let-index="index">
                            {{item.name | translate}}
                        </ng-template>
                    </ng-select>
                </div>

                <div class="form__field mb-2">
                    <label>{{ 'SETTINGS.SCALE.TITLE' | translate }}</label>
                    <ng-select class="with-circle"
                               [items]="appScaleOptions"
                               bindValue="value"
                               bindLabel="name"
                               [(ngModel)]="variablesService.settings.scale"
                               [clearable]="false"
                               [searchable]="false"
                               (change)="setScale()">
                        <ng-template ng-label-tmp
                                     let-item="item">
                            {{item.name | translate}}
                        </ng-template>
                        <ng-template ng-option-tmp
                                     let-item="item"
                                     let-index="index">
                            {{item.name | translate}}
                        </ng-template>
                    </ng-select>
                </div>

                <div class="form__field mb-2">
                    <label>{{ 'SETTINGS.APP_LOG_TITLE' | translate }}</label>
                    <ng-select class="with-circle"
                               [items]="appLogOptions"
                               bindValue="id"
                               bindLabel="id"
                               [(ngModel)]="variablesService.settings.appLog"
                               [clearable]="false"
                               [searchable]="false"
                               (change)="onLogChange()">
                    </ng-select>
                </div>

                <div class="form__field mb-2">
                    <label>{{ 'SETTINGS.NOTIFICATIONS' | translate }}</label>
                    <app-switch
                          [value]="currentNotificationsState"
                          (emitChange)="toggleNotifications()"></app-switch>
                </div>

                <div class="form__field mb-2">
                    <label>{{ 'SETTINGS.USE_TOR_TO_RELAY_TRANSACTIONS' | translate }}</label>
                    <app-switch
                          [value]="appUseTor"
                          (emitChange)="toggleUseTor()"></app-switch>
                </div>

                <form class="form"
                      [formGroup]="changeForm"
                      (ngSubmit)="onSubmitChangePass()">

                    <h4 class="master-password-title mb-2">{{ 'SETTINGS.MASTER_PASSWORD.TITLE' | translate }}</h4>

                    <div class="form__field"
                         *ngIf="variablesService.appPass">
                        <label for="old-password">{{ 'SETTINGS.MASTER_PASSWORD.OLD' | translate }}</label>
                        <input class="form__field--input"
                               type="password"
                               id="old-password"
                               [class.invalid]="changeForm.invalid && changeForm.controls['password'].valid && (changeForm.controls['password'].dirty || changeForm.controls['password'].touched) && changeForm.errors && changeForm.errors['pass_mismatch'] && changeForm.get('password').value.length > 0"
                               formControlName="password"
                               placeholder="{{ 'PLACEHOLDERS.PLACEHOLDER_OLD' | translate }}"
                               (contextmenu)="variablesService.onContextMenuPasteSelect($event)"/>
                        <div class="error"
                             *ngIf="changeForm.invalid && changeForm.controls['password'].valid && (changeForm.controls['password'].dirty || changeForm.controls['password'].touched) && changeForm.errors && changeForm.errors['pass_mismatch'] && changeForm.get('password').value.length > 0">
                            {{ 'SETTINGS.FORM_ERRORS.PASS_NOT_MATCH' | translate }}
                        </div>
                    </div>

                    <div class="form__field">
                        <label for="new-password">{{ 'SETTINGS.MASTER_PASSWORD.NEW' | translate }}</label>
                        <input class="form__field--input"
                               type="password"
                               id="new-password"
                               [class.invalid]="changeForm.controls['new_password'].errors"
                               formControlName="new_password"
                               placeholder="{{ 'PLACEHOLDERS.PLACEHOLDER_NEW' | translate }}"
                               (contextmenu)="variablesService.onContextMenuPasteSelect($event)"/>
                        <div class="error"
                             *ngIf="changeForm.controls['new_password'].dirty && changeForm.controls['new_password'].errors">
                            <div *ngIf="changeForm.controls['new_password'].errors.pattern">
                                {{ 'ERRORS.WRONG_PASSWORD' | translate }}
                            </div>
                        </div>
                    </div>

                    <div class="form__field">
                        <label for="confirm-password">{{ 'SETTINGS.MASTER_PASSWORD.CONFIRM' | translate }}</label>
                        <input class="form__field--input"
                               type="password"
                               id="confirm-password"
                               [class.invalid]="changeForm.invalid && (changeForm.controls['new_confirmation'].dirty || changeForm.controls['new_confirmation'].touched) && changeForm.errors && changeForm.errors['confirm_mismatch'] && changeForm.get('new_confirmation').value.length > 0"
                               formControlName="new_confirmation"
                               placeholder="{{ 'PLACEHOLDERS.PLACEHOLDER_CONFIRM' | translate }}"
                               (contextmenu)="variablesService.onContextMenuPasteSelect($event)"/>
                        <div class="error"
                             *ngIf="changeForm.invalid && (changeForm.controls['new_confirmation'].dirty || changeForm.controls['new_confirmation'].touched) && changeForm.errors && changeForm.errors['confirm_mismatch'] && changeForm.get('new_confirmation').value.length > 0">
                            {{ 'SETTINGS.FORM_ERRORS.CONFIRM_NOT_MATCH' | translate }}
                        </div>
                    </div>

                    <div class="submit-button-container">
                        <button type="submit"
                                class="primary big max-w-19-rem w-100"
                                [disabled]="!changeForm.valid">{{ 'SETTINGS.MASTER_PASSWORD.BUTTON' | translate }}</button>
                        <span class="ml-1 color-aqua"
                              *ngIf="ifSaved"
                              [class.active]="ifSaved">{{ 'SETTINGS.SETTINGS_SAVED' | translate }}</span>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
