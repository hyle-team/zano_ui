<div cdkTrapFocus class="auth">
    <div aria-labelledby="auth-form-title" class="auth-card">
        <h1 class="sr-only" id="auth-form-title">Authentication Card With Form</h1>

        <div aria-hidden="true" class="mb-2">
            <zano-logo></zano-logo>
        </div>

        <!-- Registration master password -->
        <form
            (ngSubmit)="onSubmitCreatePass()"
            *ngIf="type === 'reg'"
            [formGroup]="regForm"
            aria-labelledby="setup-pass-title"
            class="form"
        >
            <h2 class="sr-only" id="setup-pass-title">Setup Master Password Form</h2>

            <div class="auth-card-form">
                <!-- Master Password -->
                <div class="form__field mb-2">
                    <label for="master-pass">{{ 'LOGIN.SETUP_MASTER_PASS' | translate }}</label>
                    <input
                        (contextmenu)="variablesService.onContextMenuPasteSelect($event)"
                        [placeholder]="'PLACEHOLDERS.MASTER_PASS_PLACEHOLDER' | translate"
                        appAutofocus
                        aria-describedby="master-pass-error"
                        aria-label="Enter a master password here"
                        autocomplete="new-password"
                        class="form__field--input"
                        formControlName="password"
                        id="master-pass"
                        type="password"
                    />
                    <div
                        *ngIf="regForm.controls.password.dirty && regForm.controls.password.errors"
                        aria-live="assertive"
                        class="error"
                        id="master-pass-error"
                        role="alert"
                        tabindex="0"
                    >
                        <div *ngIf="regForm.controls.password.hasError('pattern')">
                            {{ 'ERRORS.REGEXP_INVALID_PASSWORD' | translate }}
                        </div>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div class="form__field fixed">
                    <label for="confirm-pass">{{ 'LOGIN.SETUP_CONFIRM_PASS' | translate }}</label>
                    <input
                        (contextmenu)="variablesService.onContextMenuPasteSelect($event)"
                        aria-describedby="confirm-pass-error"
                        aria-label="Confirm new password here"
                        class="form__field--input"
                        formControlName="confirmation"
                        id="confirm-pass"
                        placeholder="{{ 'PLACEHOLDERS.PLACEHOLDER_CONFIRM' | translate }}"
                        type="password"
                    />
                    <div
                        *ngIf="regForm.controls.password.dirty && regForm.controls.confirmation.dirty && regForm.errors"
                        aria-live="assertive"
                        class="error"
                        id="confirm-pass-error"
                        role="alert"
                        tabindex="0"
                    >
                        <div *ngIf="regForm.errors['mismatch']">
                            {{ 'LOGIN.FORM_ERRORS.MISMATCH' | translate }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Next -->
            <button
                [disabled]="
                    !regForm.controls.password.value.length ||
                    !regForm.controls.confirmation.value.length ||
                    (regForm.errors && regForm.hasError('mismatch')) ||
                    regForm.controls.password.errors
                "
                aria-label="Submit master password"
                class="primary big w-100 mb-1"
                type="submit"
            >
                {{ 'LOGIN.BUTTON_NEXT' | translate }}
            </button>

            <!-- Skip -->
            <button
                (click)="onSkipCreatePass()"
                [disabled]="regForm.controls.password.value.length || regForm.controls.confirmation.value.length"
                aria-label="Skip password creation"
                class="primary big w-100"
                type="button"
            >
                {{ 'LOGIN.BUTTON_SKIP' | translate }}
            </button>
        </form>

        <!-- Login -->
        <form (ngSubmit)="onSubmitAuthPass()" *ngIf="type !== 'reg'" [formGroup]="loginForm" aria-labelledby="login-title" class="form">
            <h2 class="sr-only" id="login-title">Login with Master Password</h2>

            <div class="auth-card-form">
                <div class="form__field fixed">
                    <label for="master-pass-login">
                        {{ 'LOGIN.MASTER_PASS' | translate }}
                    </label>

                    <input
                        (contextmenu)="variablesService.onContextMenuPasteSelect($event)"
                        [placeholder]="'PLACEHOLDERS.MASTER_PASS_PLACEHOLDER' | translate"
                        appAutofocus
                        aria-describedby="master-pass-login-error"
                        aria-label="Enter a master password here"
                        autocomplete="current-password"
                        class="form__field--input"
                        formControlName="password"
                        id="master-pass-login"
                        type="password"
                    />

                    <div
                        *ngIf="
                            loginForm.controls.password.invalid &&
                            (loginForm.controls.password.dirty || loginForm.controls.password.touched)
                        "
                        aria-live="assertive"
                        class="error"
                        id="master-pass-login-error"
                        role="alert"
                        tabindex="0"
                    >
                        <span *ngIf="loginForm.controls.password.hasError('wrong_password')">
                            {{ 'LOGIN.FORM_ERRORS.INVALID_PASS' | translate }}
                        </span>
                    </div>
                </div>

                <div aria-live="polite" class="sr-only" role="alert" aria-atomic="true">
                    <span *ngIf="loginForm.controls.password.hasError('wrong_password')">
                        {{ 'LOGIN.FORM_ERRORS.INVALID_PASS' | translate }}
                    </span>
                </div>
            </div>

            <!-- Login Submit -->
            <button aria-label="Log in with password" class="primary big w-100 mb-1" type="submit">
                {{ 'LOGIN.BUTTON_NEXT' | translate }}
                <span *ngIf="submitLoading" [ngTemplateOutlet]="loaderTemp" class="ml-1"></span>
            </button>

            <!-- Reset -->
            <button (click)="dropSecureAppData()" aria-label="Reset application" class="outline big w-100" type="button">
                {{ 'LOGIN.BUTTON_RESET' | translate }}
                <span *ngIf="resetLoading" [ngTemplateOutlet]="loaderTemp" class="ml-1"></span>
            </button>
        </form>
    </div>

    <app-synchronization-status></app-synchronization-status>
</div>

<ng-template #loaderTemp>
    <zano-loader aria-label="Loading" aria-live="polite" role="status"></zano-loader>
</ng-template>
