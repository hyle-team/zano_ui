<section *ngIf="variablesService.current_wallet.loaded; else skeletonTemplate" class="history-wrap" fxFlexFill fxLayout="column">
    <div class="wrap-table scrolled-content mb-2" fxFlex="1 1 auto">
        <table [attr.aria-label]="'ACCESSIBILITY.HISTORY.LABELS.LABEL1' | translate" class="zano-table history-table">
            <thead>
                <tr>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.STATUS' | translate }}</div>
                    </th>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.AMOUNT' | translate }}</div>
                    </th>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.FEE' | translate }}</div>
                    </th>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.ADDRESS' | translate }}</div>
                    </th>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.DATE' | translate }}</div>
                    </th>
                </tr>
                <tr class="row-divider"></tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let transaction of variablesService.current_wallet.history; trackBy: trackByTransaction">
                    <tr
                        (click)="toggleTransactionDetails($event, transaction.tx_hash)"
                        (keydown.enter)="toggleTransactionDetails($event, transaction.tx_hash)"
                        (keydown.space)="toggleTransactionDetails($event, transaction.tx_hash)"
                        [class.locked-transaction]="!transaction.is_mining && transaction.unlock_time > 0"
                        tabindex="0"
                    >
                        <!-- Status -->
                        <td>
                            <app-transaction-status [transaction]="transaction"></app-transaction-status>
                        </td>

                        <!-- Amount -->
                        <td>
                            <ng-container *ngFor="let item of transaction | getAmountItems : currentWallet; trackBy: trackByAmountItem">
                                <div *appVisibilityBalance [attr.aria-label]="item.amount + ' ' + item.ticker" class="cell-amount">
                                    <div class="amount">{{ item.amount }}</div>
                                    <span class="ticker">{{ item.ticker }}</span>
                                </div>
                            </ng-container>
                        </td>

                        <!-- Fee -->
                        <td>
                            <ng-container *ngIf="transaction | isVisibleFee">
                                <ng-container *ngIf="transaction?.subtransfers?.length">
                                    <ng-container *ngIf="transaction.fee; else noFeeTemplate">
                                        <mat-icon class="mr-1" style="opacity: 50" svgIcon="zano-fire"></mat-icon>

                                        {{ transaction.fee | intToMoney }}
                                        {{ variablesService.defaultTicker }}
                                    </ng-container>

                                    <ng-template #noFeeTemplate>
                                        <span>{{ 'HISTORY.NO_FEE' | translate }}</span>
                                    </ng-template>
                                </ng-container>
                            </ng-container>
                        </td>

                        <!-- Address -->
                        <td>
                            <zano-cell-address [transaction]="transaction"></zano-cell-address>
                        </td>

                        <!-- Date -->
                        <td>
                            <div class="text-ellipsis">
                                {{ transaction.timestamp * 1000 | date : 'dd.MM.yyyy HH:mm' }}
                            </div>
                        </td>
                    </tr>

                    <tr aria-hidden="true" class="row-divider"></tr>

                    <tr>
                        <td [ngStyle]="{ padding: '0', 'border-radius': '0.8rem' }" colspan="5">
                            <app-transaction-details
                                *ngIf="transaction.tx_hash === selectedTransactionHash"
                                @collapseOnLeave
                                @expandOnEnter
                                [transaction]="transaction"
                            ></app-transaction-details>
                        </td>
                    </tr>

                    <tr
                        *ngIf="transaction.tx_hash === selectedTransactionHash as state"
                        [@collapseOnLeave]="{
                            value: state,
                            params: { duration: 400 }
                        }"
                        [@expandOnEnter]="{ value: state, params: { duration: 150 } }"
                        aria-hidden="true"
                        class="row-divider"
                    ></tr>
                </ng-container>
            </tbody>
        </table>
    </div>

    <div class="pagination-wrapper">
        <div class="pagination" fxLayout="row" fxLayoutAlign="space-between center">
            <div
                [attr.aria-label]="'ACCESSIBILITY.PAGINATION.LABELS.LABEL1' | translate"
                class="left"
                fxLayout="row"
                fxLayoutAlign=" center"
                tabindex="0"
            >
                <button
                    (click)="setPage(variablesService.current_wallet.currentPage - 1)"
                    [attr.aria-label]="'ACCESSIBILITY.PAGINATION.LABELS.LABEL2' | translate"
                    [disabled]="
                        variablesService.current_wallet.currentPage === 1 ||
                        variablesService.isCurrentWalletSync ||
                        !variablesService.isCurrentWalletLoaded
                    "
                    class="btn-icon circle small mr-1"
                    tabindex="0"
                    type="button"
                >
                    <mat-icon svgIcon="zano-arrow-left"></mat-icon>
                </button>

                <ng-container *ngIf="!mining">
                    <button
                        *ngFor="let page of variablesService.current_wallet.pages; trackBy: trackByIndex"
                        (click)="setPage(page)"
                        [class.color-primary]="variablesService.current_wallet.currentPage === page"
                        [disabled]="variablesService.isCurrentWalletSync || !variablesService.isCurrentWalletLoaded"
                        class="mr-0_5"
                        tabindex="0"
                        type="button"
                    >
                        {{ page }}
                    </button>
                </ng-container>

                <ng-container *ngIf="mining">
                    <button
                        (click)="setPage(variablesService.current_wallet.currentPage)"
                        [disabled]="stopPaginate || variablesService.isCurrentWalletSync || !variablesService.isCurrentWalletLoaded"
                        [ngClass]="{
                            'color-primary': variablesService.current_wallet.currentPage,
                            disabled: variablesService.isCurrentWalletSync || !variablesService.isCurrentWalletLoaded
                        }"
                        class="mr-0_5"
                        tabindex="0"
                        type="button"
                    >
                        {{ variablesService.current_wallet.currentPage }}
                    </button>
                </ng-container>

                <button
                    (click)="setPage(variablesService.current_wallet.currentPage + 1)"
                    [attr.aria-label]="'ACCESSIBILITY.PAGINATION.LABELS.LABEL3' | translate"
                    [disabled]="stopPaginate || variablesService.isCurrentWalletSync || !variablesService.isCurrentWalletLoaded"
                    class="btn-icon circle small ml-0_5"
                    tabindex="0"
                    type="button"
                >
                    <mat-icon svgIcon="zano-arrow-right"></mat-icon>
                </button>
            </div>
            <div class="right" fxLayout="row" fxLayoutAlign=" center">
                <span class="switch-text mr-2">Hide mining transactions</span>
                <app-switch
                    (emitChange)="toggleMiningTransactions()"
                    [disabled]="variablesService.isCurrentWalletSync || !variablesService.isCurrentWalletLoaded"
                    [value]="mining"
                ></app-switch>
            </div>
        </div>
    </div>
</section>

<ng-template #skeletonTemplate>
    <section class="overflow-hidden">
        <table [attr.aria-label]="'ACCESSIBILITY.HISTORY.LABELS.LABEL1' | translate" class="zano-table history-table">
            <thead>
                <tr>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.STATUS' | translate }}</div>
                    </th>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.AMOUNT' | translate }}</div>
                    </th>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.FEE' | translate }}</div>
                    </th>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.ADDRESS' | translate }}</div>
                    </th>
                    <th scope="col">
                        <div class="bg title">{{ 'HISTORY.DATE' | translate }}</div>
                    </th>
                </tr>
                <div class="row-divider"></div>
            </thead>
            <tbody>
                <ng-container *ngFor="let _ of skeletonRows; trackBy: trackByIndex">
                    <tr style="background: none">
                        <td colspan="5" style="padding: 0">
                            <div class="skeleton skeleton-table-row"></div>
                        </td>
                    </tr>
                    <tr aria-hidden="true" class="row-divider"></tr>
                </ng-container>
            </tbody>
        </table>
    </section>
</ng-template>
